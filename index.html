<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß¨ Evolution Simulator - Life, Death, and Survival</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow-x: hidden;
            overflow-y: auto;
        }
        .container {
            display: flex;
            min-height: 100vh;
            padding: 20px;
            gap: 20px;
        }
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100% !important;
            }
        }
        .world-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .sidebar {
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }
        h1 {
            font-size: 2rem;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        #worldCanvas {
            width: 100%;
            height: auto;
            max-height: 600px;
            aspect-ratio: 2 / 1;
            background: linear-gradient(180deg, #87ceeb 0%, #228b22 100%);
            border-radius: 15px;
            cursor: crosshair;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.3);
            display: block;
        }
        @media (max-width: 768px) {
            #worldCanvas {
                max-height: 400px;
            }
        }
        .speed-control {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .speed-control h3 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3rem;
        }
        .speed-slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.3);
        }
        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        .speed-slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            border: none;
        }
        .speed-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .speed-display {
            text-align: center;
            margin-top: 10px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .stat-box {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .controls button {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-start {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
        }
        .btn-start:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0,176,155,0.4);
        }
        .btn-stop {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
        }
        .btn-reset {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .log-container {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        .log-fight { background: rgba(255, 0, 0, 0.2); }
        .log-eat { background: rgba(255, 165, 0, 0.2); }
        .log-reproduce { background: rgba(255, 192, 203, 0.3); }
        .log-death { background: rgba(128, 128, 128, 0.2); }
        .log-birth { background: rgba(0, 255, 0, 0.2); }
        .legend {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid white;
        }
        .male-color { background: #4169e1; }
        .female-color { background: #ff69b4; }
        .config-slider {
            margin-bottom: 15px;
        }
        .config-slider label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .config-slider input {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main World Area -->
        <div class="world-container">
            <h1>üß¨ Evolution Simulator</h1>

            <!-- Speed Control (Prominent) -->
            <div class="card speed-control">
                <h3>‚ö° SIMULATION SPEED</h3>
                <input type="range" id="speedSlider" class="speed-slider" min="0" max="4" value="2" step="1">
                <div class="speed-labels">
                    <span>üêå Slow</span>
                    <span>üö∂ Normal</span>
                    <span>üèÉ Fast</span>
                    <span>üöÄ Turbo</span>
                    <span>‚ö° Max</span>
                </div>
                <div class="speed-display" id="speedDisplay">Normal Speed</div>
            </div>

            <!-- Canvas -->
            <div class="card">
                <canvas id="worldCanvas"></canvas>
            </div>

            <!-- Event Log -->
            <div class="card">
                <h3>üìú Event Log</h3>
                <div class="log-container" id="logContainer"></div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Controls -->
            <div class="card controls">
                <h3>üéÆ Controls</h3>
                <button class="btn-start" id="startBtn">‚ñ∂Ô∏è START SIMULATION</button>
                <button class="btn-stop" id="stopBtn" style="display:none;">‚è∏Ô∏è PAUSE</button>
                <button class="btn-reset" id="resetBtn">üîÑ RESET</button>
            </div>

            <!-- Statistics -->
            <div class="card">
                <h3>üìä Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="totalPopulation">0</div>
                        <div class="stat-label">Total Population</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="maleCount">0</div>
                        <div class="stat-label">Males</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="femaleCount">0</div>
                        <div class="stat-label">Females</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="generationCount">0</div>
                        <div class="stat-label">Generation</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="fightCount">0</div>
                        <div class="stat-label">Fights</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="birthCount">0</div>
                        <div class="stat-label">Births</div>
                    </div>
                </div>
            </div>

            <!-- Configuration -->
            <div class="card">
                <h3>‚öôÔ∏è Configuration</h3>
                <div class="config-slider">
                    <label>
                        <span>Initial Population</span>
                        <span id="initPopValue">30</span>
                    </label>
                    <input type="range" id="initPop" min="10" max="100" value="30" step="5">
                </div>
                <div class="config-slider">
                    <label>
                        <span>Male Ratio</span>
                        <span id="maleRatioValue">50%</span>
                    </label>
                    <input type="range" id="maleRatio" min="20" max="80" value="50" step="5">
                </div>
            </div>

            <!-- Legend -->
            <div class="card legend">
                <h3>üé® Legend</h3>
                <div class="legend-item">
                    <div class="legend-color male-color"></div>
                    <div>
                        <strong>Males (Blue)</strong><br>
                        Fight other males for territory
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color female-color"></div>
                    <div>
                        <strong>Females (Pink)</strong><br>
                        Reproduce with males
                    </div>
                </div>
                <div style="margin-top: 10px;">
                    <strong>Size</strong> = Strength level<br>
                    <strong>üí•</strong> = Fighting<br>
                    <strong>ü•ó</strong> = Eating (gaining strength)<br>
                    <strong>üíï</strong> = Reproducing
                </div>
            </div>
        </div>
    </div>

    <script>
        // Actor class representing individual creatures
        class Actor {
            constructor(x, y, gender) {
                this.x = x;
                this.y = y;
                this.gender = gender; // 'male' or 'female'

                // Random traits (0-1 scale)
                this.strength = 0.3 + Math.random() * 0.7; // 0.3-1.0
                this.speed = 0.5 + Math.random() * 0.5; // 0.5-1.0
                this.fertility = 0.3 + Math.random() * 0.7; // 0.3-1.0
                this.aggression = 0.3 + Math.random() * 0.7; // 0.3-1.0

                // State
                this.alive = true;
                this.energy = 100;
                this.age = 0;
                this.generation = 0;

                // Movement
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;

                // Animation state
                this.animationState = 'idle'; // idle, fighting, eating, mating
                this.animationProgress = 0;
                this.animationPartner = null;
            }

            update(width, height, speed) {
                if (!this.alive) return;

                this.age += 0.01;

                // Random walk with some inertia
                if (Math.random() < 0.02) {
                    this.vx += (Math.random() - 0.5) * 0.5;
                    this.vy += (Math.random() - 0.5) * 0.5;
                }

                // Apply speed
                const moveSpeed = this.speed * (speed === 0 ? 0.3 : speed === 1 ? 0.5 : speed === 2 ? 1 : speed === 3 ? 2 : 4);
                this.x += this.vx * moveSpeed;
                this.y += this.vy * moveSpeed;

                // Bounce off walls
                if (this.x < 20 || this.x > width - 20) this.vx *= -1;
                if (this.y < 20 || this.y > height - 20) this.vy *= -1;

                // Keep in bounds
                this.x = Math.max(20, Math.min(width - 20, this.x));
                this.y = Math.max(20, Math.min(height - 20, this.y));

                // Update animation
                if (this.animationState !== 'idle') {
                    this.animationProgress += 0.05;
                    if (this.animationProgress >= 1) {
                        this.animationState = 'idle';
                        this.animationProgress = 0;
                        this.animationPartner = null;
                    }
                }

                // Slowly lose energy
                this.energy -= 0.01;
                if (this.energy <= 0) {
                    this.alive = false;
                }
            }

            draw(ctx) {
                if (!this.alive) return;

                ctx.save();
                ctx.translate(this.x, this.y);

                // Size based on strength
                const size = 8 + this.strength * 12;

                // Color based on gender
                if (this.gender === 'male') {
                    ctx.fillStyle = `rgb(65, 105, ${180 + this.strength * 75})`;
                } else {
                    ctx.fillStyle = `rgb(255, ${105 + this.strength * 50}, ${180 + this.strength * 75})`;
                }

                // Animation effects
                let drawSize = size;
                if (this.animationState === 'fighting') {
                    ctx.rotate(Math.sin(this.animationProgress * Math.PI * 8) * 0.3);
                    drawSize *= 1 + Math.sin(this.animationProgress * Math.PI * 4) * 0.2;
                } else if (this.animationState === 'eating') {
                    drawSize *= 1 + this.animationProgress * 0.3;
                } else if (this.animationState === 'mating') {
                    drawSize *= 1 + Math.sin(this.animationProgress * Math.PI * 2) * 0.2;
                }

                // Draw body
                ctx.beginPath();
                ctx.arc(0, 0, drawSize, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = 'rgba(0,0,0,0.3)';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Draw eyes
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(-size * 0.3, -size * 0.3, size * 0.25, 0, Math.PI * 2);
                ctx.arc(size * 0.3, -size * 0.3, size * 0.25, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(-size * 0.3, -size * 0.3, size * 0.15, 0, Math.PI * 2);
                ctx.arc(size * 0.3, -size * 0.3, size * 0.15, 0, Math.PI * 2);
                ctx.fill();

                // Draw animation icons
                if (this.animationState === 'fighting') {
                    ctx.font = '20px Arial';
                    ctx.fillText('üí•', drawSize, -drawSize);
                } else if (this.animationState === 'eating') {
                    ctx.font = '20px Arial';
                    ctx.fillText('ü•ó', drawSize, -drawSize);
                } else if (this.animationState === 'mating') {
                    ctx.font = '20px Arial';
                    ctx.fillText('üíï', drawSize, -drawSize);
                }

                ctx.restore();
            }

            distanceTo(other) {
                const dx = this.x - other.x;
                const dy = this.y - other.y;
                return Math.sqrt(dx * dx + dy * dy);
            }
        }

        // Simulation Manager
        class Simulation {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.actors = [];
                this.running = false;
                this.speed = 2;
                this.stats = {
                    generation: 0,
                    fights: 0,
                    births: 0
                };
                this.animationFrame = null;
            }

            init(population, maleRatio) {
                this.actors = [];
                this.stats = { generation: 0, fights: 0, births: 0 };

                for (let i = 0; i < population; i++) {
                    const x = 50 + Math.random() * (this.canvas.width - 100);
                    const y = 50 + Math.random() * (this.canvas.height - 100);
                    const gender = Math.random() < maleRatio / 100 ? 'male' : 'female';
                    this.actors.push(new Actor(x, y, gender));
                }

                addLog(`üå± Simulation initialized with ${population} actors`, 'birth');
            }

            start() {
                this.running = true;
                this.loop();
            }

            stop() {
                this.running = false;
                if (this.animationFrame) {
                    cancelAnimationFrame(this.animationFrame);
                }
            }

            loop() {
                if (!this.running) return;

                this.update();
                this.draw();

                this.animationFrame = requestAnimationFrame(() => this.loop());
            }

            update() {
                // Update all actors
                for (let actor of this.actors) {
                    if (actor.alive) {
                        actor.update(this.canvas.width, this.canvas.height, this.speed);
                    }
                }

                // Check interactions
                this.checkInteractions();

                // Remove dead actors
                this.actors = this.actors.filter(a => a.alive);

                // Update stats
                this.updateStats();
            }

            checkInteractions() {
                const interactionDistance = 30;

                for (let i = 0; i < this.actors.length; i++) {
                    const actor1 = this.actors[i];
                    if (!actor1.alive || actor1.animationState !== 'idle') continue;

                    for (let j = i + 1; j < this.actors.length; j++) {
                        const actor2 = this.actors[j];
                        if (!actor2.alive || actor2.animationState !== 'idle') continue;

                        const distance = actor1.distanceTo(actor2);

                        if (distance < interactionDistance) {
                            // Male meets male = fight
                            if (actor1.gender === 'male' && actor2.gender === 'male') {
                                this.fight(actor1, actor2);
                            }
                            // Male meets female = reproduce
                            else if ((actor1.gender === 'male' && actor2.gender === 'female') ||
                                     (actor1.gender === 'female' && actor2.gender === 'male')) {
                                this.reproduce(actor1, actor2);
                            }
                        }
                    }
                }
            }

            fight(actor1, actor2) {
                // Calculate fight outcome based on strength and aggression
                const power1 = actor1.strength * actor1.aggression;
                const power2 = actor2.strength * actor2.aggression;

                const winner = power1 > power2 ? actor1 : actor2;
                const loser = power1 > power2 ? actor2 : actor1;

                // Animations
                winner.animationState = 'fighting';
                winner.animationProgress = 0;
                loser.animationState = 'fighting';
                loser.animationProgress = 0;

                // Winner eats loser and gains strength
                setTimeout(() => {
                    if (winner.alive) {
                        winner.animationState = 'eating';
                        winner.animationProgress = 0;
                        winner.strength = Math.min(1.5, winner.strength + loser.strength * 0.5);
                        winner.energy = Math.min(100, winner.energy + 50);
                    }
                    loser.alive = false;

                    this.stats.fights++;
                    addLog(`üí• Fight! Winner gains strength (${winner.strength.toFixed(2)})`, 'fight');
                    addLog(`‚ò†Ô∏è Actor died in battle`, 'death');
                }, this.speed === 0 ? 1000 : 300);
            }

            reproduce(actor1, actor2) {
                const male = actor1.gender === 'male' ? actor1 : actor2;
                const female = actor1.gender === 'female' ? actor1 : actor2;

                // Check fertility
                if (Math.random() > (male.fertility + female.fertility) / 2) {
                    return; // Failed to reproduce
                }

                // Animations
                male.animationState = 'mating';
                male.animationProgress = 0;
                female.animationState = 'mating';
                female.animationProgress = 0;

                // Create offspring
                setTimeout(() => {
                    const childGender = Math.random() < 0.5 ? 'male' : 'female';
                    const child = new Actor(
                        (male.x + female.x) / 2 + (Math.random() - 0.5) * 40,
                        (male.y + female.y) / 2 + (Math.random() - 0.5) * 40,
                        childGender
                    );

                    // Inherit traits with some mutation
                    child.strength = (male.strength + female.strength) / 2 + (Math.random() - 0.5) * 0.2;
                    child.speed = (male.speed + female.speed) / 2 + (Math.random() - 0.5) * 0.2;
                    child.fertility = (male.fertility + female.fertility) / 2 + (Math.random() - 0.5) * 0.2;
                    child.aggression = (male.aggression + female.aggression) / 2 + (Math.random() - 0.5) * 0.2;

                    // Clamp values
                    child.strength = Math.max(0.1, Math.min(1.5, child.strength));
                    child.speed = Math.max(0.3, Math.min(1.2, child.speed));
                    child.fertility = Math.max(0.1, Math.min(1.0, child.fertility));
                    child.aggression = Math.max(0.1, Math.min(1.0, child.aggression));

                    child.generation = Math.max(male.generation, female.generation) + 1;

                    this.actors.push(child);
                    this.stats.births++;

                    addLog(`üë∂ New ${childGender} born! Gen: ${child.generation}`, 'birth');
                }, this.speed === 0 ? 1500 : 500);
            }

            draw() {
                // Clear canvas
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                gradient.addColorStop(0, '#87ceeb');
                gradient.addColorStop(1, '#228b22');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Draw all actors
                for (let actor of this.actors) {
                    actor.draw(this.ctx);
                }

                // Draw population count
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                this.ctx.fillRect(10, 10, 200, 40);
                this.ctx.fillStyle = 'white';
                this.ctx.font = 'bold 20px Arial';
                this.ctx.fillText(`Population: ${this.actors.length}`, 20, 35);
            }

            updateStats() {
                document.getElementById('totalPopulation').textContent = this.actors.length;
                document.getElementById('maleCount').textContent = this.actors.filter(a => a.gender === 'male').length;
                document.getElementById('femaleCount').textContent = this.actors.filter(a => a.gender === 'female').length;
                document.getElementById('generationCount').textContent = Math.max(...this.actors.map(a => a.generation), 0);
                document.getElementById('fightCount').textContent = this.stats.fights;
                document.getElementById('birthCount').textContent = this.stats.births;
            }
        }

        // Log system
        let logEntries = [];
        function addLog(message, type) {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();

            logEntries.unshift({ message: `[${timestamp}] ${message}`, type });
            if (logEntries.length > 50) logEntries.pop();

            logContainer.innerHTML = logEntries.map(entry =>
                `<div class="log-entry log-${entry.type}">${entry.message}</div>`
            ).join('');
        }

        // Initialize
        const canvas = document.getElementById('worldCanvas');
        const sim = new Simulation(canvas);

        // Set canvas size responsively
        function resizeCanvas() {
            const container = canvas.parentElement;
            const rect = container.getBoundingClientRect();
            const width = rect.width - 40; // Account for padding
            const height = Math.min(600, width / 2); // 2:1 aspect ratio, max 600px

            canvas.width = width;
            canvas.height = height;

            // Redraw if simulation exists
            if (sim.actors.length > 0) {
                sim.draw();
            }
        }

        // Initial resize
        resizeCanvas();

        // Resize on window resize
        window.addEventListener('resize', resizeCanvas);

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', () => {
            if (!sim.running) {
                if (sim.actors.length === 0) {
                    const pop = parseInt(document.getElementById('initPop').value);
                    const ratio = parseInt(document.getElementById('maleRatio').value);
                    sim.init(pop, ratio);
                }
                sim.start();
                document.getElementById('startBtn').style.display = 'none';
                document.getElementById('stopBtn').style.display = 'block';
                addLog('‚ñ∂Ô∏è Simulation started', 'birth');
            }
        });

        document.getElementById('stopBtn').addEventListener('click', () => {
            sim.stop();
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('stopBtn').style.display = 'none';
            addLog('‚è∏Ô∏è Simulation paused', 'death');
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            sim.stop();
            const pop = parseInt(document.getElementById('initPop').value);
            const ratio = parseInt(document.getElementById('maleRatio').value);
            sim.init(pop, ratio);
            sim.draw();
            document.getElementById('startBtn').style.display = 'block';
            document.getElementById('stopBtn').style.display = 'none';
            logEntries = [];
            addLog('üîÑ Simulation reset', 'birth');
        });

        document.getElementById('speedSlider').addEventListener('input', (e) => {
            sim.speed = parseInt(e.target.value);
            const labels = ['üêå Slow (Animated)', 'üö∂ Normal', 'üèÉ Fast', 'üöÄ Turbo', '‚ö° Maximum Speed'];
            document.getElementById('speedDisplay').textContent = labels[sim.speed];
        });

        // Config sliders
        document.getElementById('initPop').addEventListener('input', (e) => {
            document.getElementById('initPopValue').textContent = e.target.value;
        });

        document.getElementById('maleRatio').addEventListener('input', (e) => {
            document.getElementById('maleRatioValue').textContent = e.target.value + '%';
        });

        // Initialize display
        const pop = parseInt(document.getElementById('initPop').value);
        const ratio = parseInt(document.getElementById('maleRatio').value);
        sim.init(pop, ratio);
        sim.draw();
    </script>
</body>
</html>